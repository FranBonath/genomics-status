<html>
    <head>
        <title>Pika/Tornado Example</title>
        <link rel="icon" type="/image/vnd.microsoft.icon" 
        href="http://www.rabbitmq.com/favicon.ico" />
        <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>-->
        <script type="text/javascript" src="static/jquery/dist/jquery.js"></script>
        <script type="text/javascript" src="static/d3/d3.js"></script> 
        
        <script type="text/javascript">
            function get_messages()
            {
                $.getJSON('/ajax', function(data){
                    for ( var x = 0; x < data.length; x++ )
                    {
                        $('ul').prepend('<li>' + data[x] + '</li>');
                    }
                    while ( $('ul li').length > 25 ) { $('ul li:last').remove(); }
                });
            }
            $(document).ready(function(){

                var ws_uri = "ws://0.0.0.0:8888/websocket";
                ws = new WebSocket(ws_uri);

                ws.onmessage = function(e) {
                    console.log(e.data);
                    data.shift()
                    data.push(JSON.parse(e.data));
                    redraw();
                }
            });

        </script>

        <style type="text/css">
        html {
            font-family: Helvetica,Arial,Sans-Serif;
            font-size: 12px;
        }
        </style>

    </head>
    <body>
        <h1>Pika/Tornado Example</h1>
        
        <p>Connected: <strong>{{ connected }}</strong></p>
        
        <p>Every request that your browser makes enqueues a message into
        RabbitMQ which is then delivered back to the Application's Pika
        Client. When you poll, you recieve all the messages delivered since
        your last poll. It will only retain the last 15 messages received.</p>

        <p>If you want to enqueue your own messages to be delivered here, just
        publish to the &ldquo;tornado&rdquo; exchange using the routing key of
        &ldquo;tornado.*&rdquo;</p>
        
        <h2>Messages Received Asynchronously from RabbitMQ</h2>
        <ul>
        </ul>
        <article>
            <p>
            <button onclick="ws.send('get log')">Get log entry</button>
            <button onclick="redraw()">Draw again</button>
            </p>
            <script type="text/javascript" src="static/size_bars.js">
            </script>
            <script type="text/javascript">
            // var ws = new WebSocket("ws://0.0.0.0/websocket")
            init_draw();
            </script>
            <!-- Here perform the plot -->
        </article>

    </body>
</html>