{% extends 'base.html' %}
{% block stuff %}
{% import re %}
<div id="page_content">
    <h1>Flow Cell <span id="page_title">{{ flowcell.get('run_name') }}</span></h1>
    <table class="table table-bordered narrow-headers" id="fc_info">
      <tr class="darkth">
      <!-- Run identifiers -->
        <th>MinKNOW Experiment name:</th>
        <td>{{ display(flowcell.get('experiment_name')) }}</td>
      </tr>
      <tr class="darkth">
        <th>MinKNOW Sample name:</th>
        <td>{{ display(flowcell.get('sample_name')) }}</td>
      </tr>
      <tr class="darkth">
        <th>MinKNOW Run name:</th>
        <td>{{ display(flowcell.get('run_name')) }}</td>
      </tr>
      <tr class="darkth">
        <th>MinKNOW Run ID:</th>
        <td>{{ display(flowcell.get('run_id')) }}</td>
      </tr>
      <!-- Time and status -->
      <tr class="darkth">
        <th>Run status:</th>
        <td>{{ display(flowcell.get('TACA_run_status')) }}</td>
      </tr>
      <tr class="darkth">
        <th>Start date:</th>
        <td>{{ display(flowcell.get('start_date')) }}</td>
      </tr>
      <tr class="darkth">
        <th>End date:</th>
        <td>{{ display(flowcell.get('end_date')) }}</td>
      </tr>
      <!-- Hardware -->
      <tr class="darkth">
        <th>Instrument:</th>
        <td>{{ display(flowcell.get('instrument')) }}</td>
      </tr>
      <tr class="darkth">
        <th>Position:</th>
        <td>{{ display(flowcell.get('position')) }}</td>
      </tr>
      <tr class="darkth">
        <th>Flowcell type:</th>
        <td>{{ display(flowcell.get('flow_cell_type')) }}</td>
      </tr>
      <tr class="darkth">
        <th>Flowcell ID:</th>
        <td>{{ display(flowcell.get('flow_cell_id')) }}</td>
      </tr>
      <tr class="darkth">
        <th>Prep kit:</th>
        <td>{{ display(flowcell.get('prep_kit')) }}</td>
      </tr>
      <tr class="darkth">
        <th>Barcoding kit:</th>
        <td>{{ display(flowcell.get('barcoding_kit')) }}</td>
      </tr>
    </table>
    <div class="tabbable mb-3">
      <ul class="nav nav-tabs">
        <li class="nav-item">
          <a class="nav-link active" href="#tab_flowcell_information" role="tab" data-toggle="tab">Flowcell Information</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#tab_running_notes_content" role="tab" data-toggle="tab">Running Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#tab_links_content" role="tab" data-toggle="tab">Links</a>
        </li>
      </ul>
    </div>
    <div class="tab-content">
      <div class="tab-pane fade show active" id="tab_flowcell_information">
        <h3>Barcode information</h3>
        <table class="table table-bordered narrow-headers no-margin right_align_headers" id="ont_barcodes">
            <thead id="ont_fc_table_head">
                <tr class="sticky darkth">
                    <th>Barcode</th>
                    <th>Alias</th>
                    <th>Read count passed</th>
                    <th>% Read count passed total</th>
                    <th>Bases passed (bp)</th>
                    <th>% Bases passed total</th>
                    <th>Average read length passed (bp)</th>
                    <th>% Pass / Fail</th>
                </tr>
            </thead>
            <tbody>
            {% if barcodes %}
              {% for bc in barcodes %}
              <tr>
                  <td class="bc_name">{{ barcodes[bc]["bc_name"] }}</td>
                  <td class="bc_alias">{{ barcodes[bc]["barcode_alias"] }}</td>
                  <td class="basecalled_pass_read_count">{{ '{:,}'.format(barcodes[bc]["basecalled_pass_read_count"]).replace(',', ' ') }}</td>
                  <td class="basecalled_pass_read_count_pc">{{ barcodes[bc]["basecalled_pass_read_count_pc"] }}</td>
                  <td class="basecalled_pass_bases">{{ '{:,}'.format(barcodes[bc]["basecalled_pass_bases"]).replace(',', ' ') }}</td>
                  <td class="basecalled_pass_bases_pc">{{ barcodes[bc]["basecalled_pass_bases_pc"] }}</td>
                  <td class="average_read_length_passed">{{ '{:,}'.format(barcodes[bc]["average_read_length_passed"]).replace(',', ' ') }}</td>
                  <td class="accuracy">{{ barcodes[bc]["accuracy"] }}</td>
              </tr>
              {% end %} 
            {% end %}
            </tbody>
        </table>
      </div>
      <div class="tab-pane fade" id="tab_running_notes_content">
      </div>
      <div class="tab-pane fade" id="tab_links_content">
      </div>
    </div>
</div>

<script src="/static/js/jquery.dataTables.min.js"></script>
<!-- Table Sorting -->
<script type="text/javascript">
$( document ).ready(function() {
  init_listjs();
});
// Initialize sorting and searching javascript plugin
function init_listjs() {
    // Setup - add a text input to each footer cell
    $('#ont_barcodes tfoot th').each( function () {
      var title = $('#ont_barcodes thead th').eq( $(this).index() ).text();
      $(this).html( '<input size=10 type="text" placeholder="Search '+title+'" />' );
    } );
    
    var table = $('#ont_barcodes').DataTable({
      "paging":false,
      "info":false,
      "order": [[ 0, "asc"  ]]
    });

    //Add the bootstrap classes to the search thingy
    $('div.dataTables_filter input').addClass('form-control search search-query');
    $('#fc_table_filter').addClass('form-inline float-right');
    $("#fc_table_filter").appendTo("h1");
    $('#fc_table_filter label input').appendTo($('#fc_table_filter'));
    $('#fc_table_filter label').remove();
    $("#fc_table_filter input").attr("placeholder", "Search..");
    // Apply the search
    table.columns().every( function () {
        var that = this;
        $( 'input', this.footer() ).on( 'keyup change', function () {
            that
            .search( this.value )
            .draw();
        } );
    } );
}
</script>

{% end %}