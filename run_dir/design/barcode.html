{% extends "base_b5.html" %}
<!--
Template file: barcode.html
URL: /barcode/
Title: Label and Barcode printing NGI
Description: Printing of Labels and Barcodes on the Main Lab barcode printer Zebra
-->

{% block stuff %}
<h1><span id="page_title">NGI Plate Label and Barcode Printing</span></h1>
<br>
<h3><span>Label and barcode printing for workset plates or internal use</span></h3>
<p>Here you can print plate labels and barcodes on the label printer "Zebra". Either enter
a text in the text field or upload a file.<p>
<p>Valid files are barcode files generated by LIMS or text files. In text files,
  each line will be printed on a separate label.<p>
<br>
<div id="query">
  <form class="form-horizontal" enctype="multipart/form-data" role="form" id="barcode_from_file" method="post" action="/barcode" onsubmit="return submit_form('lab_labels')">
    <div class="row">
      <div class="col-3 float-left" style="margin-right:5px">
        <input id="print_label_file" type="file" name="file_to_print"  class="form-control"/>
        <input type="hidden" id="formType" name="formType" value="lab_labels">
      </div>
    </div>
    <br>
    <div class="row" style="margin-right:5px">
      <div class="col-3">
        <input id="print_label_string" size="37" type="text" name="text_to_print" class="form-control text-center" placeholder="your text here" />
      </div>
      <div class="col-3">
        <td style="font-size:20px;"><strong> print with barcode:</strong></td>
        <input id="print_with_barcode" type="checkbox" name="print_with_barcode" >
      </div>
    </div>
    <br>
    <div class="row text-center" style="margin-right:5px">
      <div class="col-auto">
        <td style="font-size:20px;"><strong> copies:</strong></td>
      </div>
      <div class="col-auto">
        <input id="label_copies" type="number" min="1" max="20" name="copies" class="form-control" value="1" />
      </div>
      <div class="col-auto">
        <button type="submit" class="btn btn-primary btn-lg" data-script="barcode">Print</button>
      </div>
    </div>

  </form>
</div>
<br>
<hr>
<h3><span>User Project Barcode Printing</span></h3>
<div id="query">
  <form class="form-horizontal" enctype="multipart/form-data" role="form" id="project_barcode_from_text" method="post" action="/barcode" onsubmit="return submit_form('user_labels')">
    <div class="row text-center" style="margin-right:5px">
      <div class="col-3">
        <input id="print_projectlabel" size="37" type="text" name="projectLabel_to_print" class="form-control" placeholder="enter Project ID (i.e. P12345)" />
      </div>
      <div class="col-auto col-form-label">
        <td style="font-size:20px;"><strong> start no. plate P_:</strong></td>
      </div>
      <div class="col-1">
        <input id="project_Pstart" type="number" min="1" max="20" name="plate_start" class="form-control" value="1" />
      </div>
      <div class="col-auto col-form-label">
        <td style="font-size:20px;"><strong> end no. plate P_:</strong></td>
      </div>
      <div class="col-1">
        <input id="project_Pend" type="number" min="1" max="20" name="plate_end" class="form-control" value="5" />
      </div>
      <div class="col-auto col-form-label">
        <td style="font-size:20px;"><strong> number of projects:</strong></td>
      </div>
      <div class="col-1">
        <input id="numberOfProjects" type="number" min="1" max="20" name="numberOfProjects" class="form-control" value="1" />
      </div>
      <input type="hidden" id="formType" name="formType" value="user_labels">
    </div>
    <br>
    <div class="row" style="margin-right:5px">
      <div class="col-auto">
        <button type="submit" class="btn btn-primary btn-lg" data-script="barcode">Print Project Labels</button>
      </div>
    </div>
    <br>
    <br>
  </form>

<script type="text/javascript">
  function submit_form(label_type) {
    if($.trim($('#print_label_file').val()).length == 0 && $.trim($('#print_label_string').val()).length == 0 && $.trim($('#print_projectlabel').val()).length == 0){
      alert('File, text and project label input fields cannot be empty at the same time!');
      return false;
    }

    if(label_type == 'lab_labels'){ submission_data = '#barcode_from_file'; }
    else if(label_type == 'user_labels'){ submission_data = '#project_barcode_from_text'; }

    $.ajax({
           type: "POST",
           url: $(submission_data).attr('action'),
           data: new FormData($(submission_data).get(0)),
           processData: false,
           contentType: false,
           error: function(xhr, textStatus, errorThrown) {
             alert('Error: '+xhr.responseJSON['Error']);
             console.log(xhr); console.log(textStatus); console.log(errorThrown);
           },
           success: function(data, textStatus, xhr){
               alert(data['message']);
           }
         });
    return false; // avoid execution of the actual submit of the form.
}
</script>

{% end %}
