{% extends "base.html" %}
<!--
Template file: controls.html
URL: /controls/
Title: Controls
Description: Overview of positive and negative controls
-->

{% block stuff %}
<h1 class="worksets_page_heading"><span id="page_title">Positive and Negative Controls</span></h1>
</div>
  <div id="page_content" >
    <div class="tabbable">
      <ul class="nav nav-tabs" role="tablist">
        <li class="nav-item"><a class="nav-link active" href="#tab_negative_controls" role="tab" data-toggle="tab" aria-selected="true">Negative Controls</a></li>
        <li class="nav-item"><a class="nav-link" href="#tab_positive_controls" role="tab" data-toggle="tab">Positive Controls</a></li>
      </ul>
      <div class="tab-content">
        <div class="tab-pane fade show active" id="tab_negative_controls">
          <h2 class="negative_controls_heading"><small class="text-muted">all negative controls with worksets</small></h2>
          <div id="neg_control-list">
            <table class="table table-striped table-bordered sortable" id="negative_controls_table">
              <thead id="negative_controls_table_head">
                <tr class="sticky darkth">
                 {% for onekey in headers %}
                    <th class="sort">{{ onekey[0] }}</th>
                 {% end %}
                 </tr>
              </thead>
              <tfoot id="negative_controls_table_footer">
                <tr class="darkth">
                  {% for onekey in headers %}
                     <th class="sort">{{ onekey[0] }}</th>
                  {% end %}
                  </tr>
              </tfoot>
              <tbody id="negative_controls_table_body">
                {% for control in negative_control_data%}
                <tr>
                  {% for onekey in headers %}
                    {% if onekey[1] == 'project' %}
                    <td>
                      <span class="label label-date sentenceCase">{{ negative_control_data[control].get(onekey[1]) }}</span>
                    </td>
                    {% elif onekey[1] == 'sample_id' %}
                    <td>
                      <span class="label label-date sentenceCase">{{ negative_control_data[control].get(onekey[1]) }}</span>
                    </td>
                    {% elif onekey[1] == 'customer_name' %}
                    <td>
                      <span class="label label-date sentenceCase">{{ negative_control_data[control].get(onekey[1]) }}</span>
                    </td>
                    {% elif onekey[1] == 'status_manual' %}
                    <td>
                      <span class="label label-date sentenceCase">{{ negative_control_data[control].get(onekey[1]) }}</span>
                    </td>
                    {% elif onekey[1] == 'workset_name' %}
                    <td>
                      <a href="/workset/{{ negative_control_data[control].get(onekey[0]) }}" style="color:#000000;">{{ negative_control_data[control].get(onekey[1]) }}</a>
                    </td>
                    {% elif onekey[1] == 'workset_projects' %}
                      <td>
                        {% if negative_control_data.get(control).get('ws_name_used_only') %} <!-- labels if projects have been retrieved based on the workset name only -->
                          <span class="label label-date sentenceCase">**</span>
                        {%end%}
                        {% for i in range(0,len(negative_control_data.get(control).get(onekey[1]).get('ws_project_names'))) %}
                          <a href="/project/{{ negative_control_data.get(control).get(onekey[1]).get('ws_project_numbers')[i] }}" class="text-success text-decoration-none" data-toggle="tooltip" title="Status"><i class="fa fa-folder-open">&nbsp;</i> {{ negative_control_data.get(control).get(onekey[1]).get('ws_project_names')[i] }} </a>                     
                          &nbsp;<br>
                        {%end%}
                      </td>
                    {% elif onekey[1] == 'prep_status' %}
                    <td>
                      <span class="label label-date sentenceCase">{{ negative_control_data[control].get(onekey[1]) }}</span>
                    </td>
                    {% elif onekey[1] == 'sequenced_fc' %}
                    <td>
                      {% for fc in negative_control_data.get(control).get(onekey[1]) %}
                        <a href="/flowcells/{{fc}}" style="color:#2856E5;text-decoration: none;"><i class="fa fa-folder-open">&nbsp;</i> {{ fc }} </a>                     
                        <br>
                      {%end%}
                    </td>
                    {%end%}
                    {%end%}
                </tr>
                {%end%}
              </tbody>
            </table>
          </div>
        </div>
      <div class="tab-pane fade" id="tab_positive_controls">
        <h2 class="positive_controls_heading"><small class="text-muted">all positive controls with worksets</small></h2>
        <div id="pos_control-list">
          &nbsp;
          <table class="table table-striped table-bordered sortable" id="positive_controls_table">
            <thead id="positive_controls_table_head">
              <tr class="sticky darkth">
                {% for onekey in headers %}
                  <th class="sort">{{ onekey[0] }}</th>
                {% end %}
              </tr>
            </thead>
            <tfoot id="positive_controls_table_footer">
              <tr class="darkth">
                {% for onekey in headers %}
                  <th class="sort">{{ onekey[0] }}</th>
                {% end %}
              </tr>
            </tfoot>
            <tbody id="positive_controls_table_body">
              {% for control in positive_control_data%}
              <tr>
                {% for onekey in headers %}
                  {% if onekey[1] == 'project' %}
                  <td>
                    <span class="label label-date sentenceCase">{{ positive_control_data[control].get(onekey[1]) }}</span>
                  </td>
                  {% elif onekey[1] == 'sample_id' %}
                  <td>
                    <span class="label label-date sentenceCase">{{ positive_control_data[control].get(onekey[1]) }}</span>
                  </td>
                  {% elif onekey[1] == 'customer_name' %}
                  <td>
                    <span class="label label-date sentenceCase">{{ positive_control_data[control].get(onekey[1]) }}</span>
                  </td>
                  {% elif onekey[1] == 'status_manual' %}
                  <td>
                    <span class="label label-date sentenceCase">{{ positive_control_data[control].get(onekey[1]) }}</span>
                  </td>
                  {% elif onekey[1] == 'workset_name' %}
                  <td>
                    <a href="/workset/{{ positive_control_data[control].get(onekey[1]) }}" style="color:#000000;">{{ positive_control_data[control].get(onekey[1]) }}</a>
                  </td>
                  {% elif onekey[1] == 'workset_projects' %}
                    <td>
                      {% if positive_control_data.get(control).get('ws_name_used_only') %} <!-- labels if projects have been retrieved based on the workset name only -->
                        <span class="label label-date sentenceCase">**</span>
                      {%end%}
                      {% for i in range(0,len(positive_control_data.get(control).get(onekey[1]).get('ws_project_names'))) %}
                          <a href="/project/{{ positive_control_data.get(control).get(onekey[1]).get('ws_project_numbers')[i] }}" class="text-success text-decoration-none" data-toggle="tooltip" title="Status"><i class="fa fa-folder-open">&nbsp;</i> {{ positive_control_data.get(control).get(onekey[1]).get('ws_project_names')[i] }} </a>                     
                          &nbsp;<br>
                        {%end%}
                    </td>
                  {% elif onekey[1] == 'prep_status' %}
                  <td>
                    <span class="label label-date sentenceCase">{{ positive_control_data[control].get(onekey[1]) }}</span>
                  </td>
                  {% elif onekey[1] == 'sequenced_fc' %}
                  <td>
                    {% for fc in positive_control_data.get(control).get(onekey[1]) %}
                      <a href="/flowcells/{{fc}}" style="color:#2856E5;text-decoration: none;"><i class="fa fa-folder-open">&nbsp;</i> {{ fc }} </a>                     
                      <br>
                    {%end%}
                  </td>
                  {%end%}
                  {%end%}
              </tr>
              {%end%}
          </table>
        </div>
        </div>
      </div>
    </div>
  </div> 
</div>

<script src="/static/js/dataTables-extensions-1.13.6.min.js"></script>
<script src="/static/js/running_notes.js"></script>

<!-- Table Sorting -->
<script type="text/javascript">
  $( document ).ready(function() {
    document.title = 'something else';
    init_listjs_controls();
    format_latest_running_note();
  });

// Initialize sorting and searching javascript plugin 
function init_listjs_controls() {
    // Setup - add a text input to each footer cell
    $('#negative_controls_table tfoot th').each( function () {
      var title = $('#negative_controls_table thead th').eq( $(this).index() ).text();
      $(this).html( '<input size=10 type="text" placeholder="'+title+'" />' );
    } );

    var table = $('#negative_controls_table').DataTable({
      "paging":false,
      "info":false,
      "order": [[ 1, "desc" ]],
      colReorder: true,
      dom: 'Bfrti',
      buttons: [
        { extend: 'copy', className: 'btn btn-outline-dark mb-3' },
        { extend: 'excel', className: 'btn btn-outline-dark mb-3' }
      ]
    });

    //console.log(table);
    //Add the bootstrap classes to the search thingy
    //$('div.dataTables_filter input').addClass('form-control search search-query');
    $('#negative_controls_table_filter').addClass('form-inline float-right pt-1');
    $("#negative_controls_table_filter").appendTo($('#neg_control-list'));
    $('#negative_controls_table_filter label input').appendTo($('#negative_controls_table_filter'));
    $('#negative_controls_table_filter label').remove();
    $("#negative_controls_table_filter input").attr("placeholder", "Search...");

    // Apply the search
    table.columns().every( function () {
        var that = this;
        $( 'input', this.footer() ).on( 'keyup change', function () {
            that
            .search( this.value )
            .draw();
        } );
    } );
    $(".dt-buttons > .buttons-copy").prepend("<span class='mr-1 fa fa-copy'>");
    $(".dt-buttons > .buttons-excel").prepend("<span class='mr-1 fa fa-file-excel'>");
}
</script>


{% end %}